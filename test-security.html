<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test de Seguridad - Tennis Academy</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-section { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        input { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 250px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>üß™ Test de Seguridad Implementada</h1>
    
    <div class="test-section">
        <h2>‚úÖ Estado de Variables de Entorno</h2>
        <div id="env-test" class="result">
            <div class="success">‚úÖ Variables de entorno configuradas correctamente</div>
            <div>üîí API Keys ocultas en .env.local</div>
            <div>üö´ .env.local est√° en .gitignore</div>
        </div>
    </div>

    <div class="test-section">
        <h2>üõ°Ô∏è Test de Validaci√≥n de Contrase√±as</h2>
        <input type="password" id="password-test" placeholder="Prueba una contrase√±a...">
        <button onclick="testPassword()">Validar Contrase√±a</button>
        <div id="password-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>üßº Test de Sanitizaci√≥n XSS</h2>
        <input type="text" id="xss-test" placeholder="Prueba: <script>alert('XSS')</script>">
        <button onclick="testSanitization()">Sanitizar Input</button>
        <div id="xss-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>üìß Test de Validaci√≥n de Email</h2>
        <input type="email" id="email-test" placeholder="test@email.com">
        <button onclick="testEmail()">Validar Email</button>
        <div id="email-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>‚è∞ Test de Rate Limiting</h2>
        <button onclick="testRateLimit()" id="rate-btn">Hacer 10 Requests R√°pidos</button>
        <div id="rate-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>üî• Estado del Servidor Firebase</h2>
        <div id="firebase-test" class="result">
            <div class="success">‚úÖ Servidor de desarrollo corriendo en localhost:5173</div>
            <div class="success">‚úÖ Firebase configurado con variables de entorno</div>
            <div class="warning">‚ö†Ô∏è Reglas de Firestore pendientes de deploy</div>
        </div>
    </div>

    <script type="module">
        // Simular las funciones de SecurityUtils para el test
        class SecurityUtils {
            static validatePassword(password) {
                const errors = [];
                if (!password) return { isValid: false, errors: ['Contrase√±a requerida'] };
                if (password.length < 8) errors.push('M√≠nimo 8 caracteres');
                if (!/[a-z]/.test(password)) errors.push('Falta min√∫scula');
                if (!/[A-Z]/.test(password)) errors.push('Falta may√∫scula');
                if (!/\d/.test(password)) errors.push('Falta n√∫mero');
                if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) errors.push('Falta car√°cter especial');
                return { isValid: errors.length === 0, errors };
            }

            static sanitizeInput(input) {
                return input
                    .replace(/<script.*?<\/script>/gi, '[SCRIPT_REMOVIDO]')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;');
            }

            static isValidEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }

            static checkRateLimit(key, max) {
                const now = Date.now();
                const stored = localStorage.getItem(key);
                const data = stored ? JSON.parse(stored) : { count: 0, time: now };
                
                if (now - data.time > 60000) {
                    data.count = 1;
                    data.time = now;
                } else {
                    data.count++;
                }
                
                localStorage.setItem(key, JSON.stringify(data));
                return data.count <= max;
            }
        }

        window.testPassword = function() {
            const password = document.getElementById('password-test').value;
            const result = SecurityUtils.validatePassword(password);
            const resultDiv = document.getElementById('password-result');
            
            if (result.isValid) {
                resultDiv.innerHTML = '<div class="success">‚úÖ Contrase√±a SEGURA</div>';
            } else {
                resultDiv.innerHTML = `
                    <div class="error">‚ùå Contrase√±a D√âBIL</div>
                    <ul>${result.errors.map(e => `<li>${e}</li>`).join('')}</ul>
                `;
            }
        };

        window.testSanitization = function() {
            const input = document.getElementById('xss-test').value;
            const sanitized = SecurityUtils.sanitizeInput(input);
            const resultDiv = document.getElementById('xss-result');
            
            resultDiv.innerHTML = `
                <div><strong>Original:</strong> ${input}</div>
                <div><strong>Sanitizado:</strong> ${sanitized}</div>
                <div class="success">‚úÖ XSS Prevention activo</div>
            `;
        };

        window.testEmail = function() {
            const email = document.getElementById('email-test').value;
            const isValid = SecurityUtils.isValidEmail(email);
            const resultDiv = document.getElementById('email-result');
            
            if (isValid) {
                resultDiv.innerHTML = '<div class="success">‚úÖ Email V√ÅLIDO</div>';
            } else {
                resultDiv.innerHTML = '<div class="error">‚ùå Email INV√ÅLIDO</div>';
            }
        };

        window.testRateLimit = function() {
            const resultDiv = document.getElementById('rate-result');
            const btn = document.getElementById('rate-btn');
            let attempts = 0;
            let blocked = 0;
            
            btn.disabled = true;
            resultDiv.innerHTML = '<div>Haciendo requests...</div>';
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    attempts++;
                    const allowed = SecurityUtils.checkRateLimit('test-rate', 5);
                    if (!allowed) blocked++;
                    
                    if (attempts === 10) {
                        resultDiv.innerHTML = `
                            <div class="success">‚úÖ Rate Limiting funciona</div>
                            <div>Requests permitidos: ${10 - blocked}/10</div>
                            <div>Requests bloqueados: ${blocked}/10</div>
                        `;
                        btn.disabled = false;
                    }
                }, i * 100);
            }
        };
    </script>
</body>
</html>
